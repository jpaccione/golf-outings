<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Douglaston Golf Outing - August 15, 2025</title>
    <!-- Google Fonts - Inter (keeping this as it's a nice, modern font) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Link to your custom styles.css -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">

        <!-- Header Section -->
        <header>
            <h1>Douglaston Golf Outing<br>August 15, 2025</h1>
        </header>

        <!-- Event Details Section -->
        <section class="event-details">
            <h2>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
                Event Details
            </h2>
            <div class="details-content">
                <div>
                    <p class="label">Location:</p>
                    <p class="value">Douglaston Golf Course - Queens, NY</p>
                    <a href="https://www.google.com/maps/search/Douglaston+Golf+Course,+Queens,+NY" target="_blank" class="external-link">
                        View on Google Maps
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                    </a>
                </div>
                <div class="text-right">
                    <p class="label">Tee Time:</p>
                    <p class="value">1:42 PM</p>
                </div>
            </div>
        </section>

        <!-- Weather Forecast Section -->
        <section class="weather-forecast">
            <h2>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M17.778 8.222l-7-7a.75.75 0 00-1.06 0l-7 7a.75.75 0 001.06 1.06L9 3.06V16.5a.75.75 0 001.5 0V3.06l5.47 5.47a.75.75 0 001.06-1.06z" clip-rule="evenodd" />
                </svg>
                Live Weather Forecast
            </h2>
            <div id="weather-content" class="weather-container">
                <p class="loading-message">Loading weather data...</p>
            </div>
        </section>

        <!-- Attendees Section -->
        <section class="attendees">
            <h2>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                </svg>
                Attendees
            </h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Tee Time</th>
                            <th>Arrival at Course</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Your Name</td>
                            <td>1:42 PM</td>
                            <td>1:15 PM</td>
                            <td>Solo outing (for now!)</td>
                        </tr>
                        <tr>
                            <td>VACANT 1</td>
                            <td>1:42 PM</td>
                            <td>1:15 PM</td>
                            <td>TBD</td>
                        </tr>
                        <tr>
                            <td>VACANT 2</td>
                            <td>1:42 PM</td>
                            <td>1:15 PM</td>
                            <td>TBD</td>
                        </tr>
                        <tr>
                            <td>VACANT 3</td>
                            <td>1:42 PM</td>
                            <td>1:15 PM</td>
                            <td>TBD</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Notes and Important Information Section -->
        <section class="important-notes">
            <h2>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
                Important Notes
            </h2>
            <ul>
                <li><strong>Driving Directions:</strong> Please set your GPS to **Douglaston Golf Course** (6320 Marathon Pkwy, Little Neck, NY 11362).</li>
                <li><strong>Arrival Time:</strong> Plan to arrive at Douglaston Golf Course by <strong>1:15 PM</strong> to allow time for check-in and warm-up.</li>
                <li><strong>Tee Time:</strong> Our tee time is <strong>1:42 PM</strong>. Please be ready at the tee box at least 10 minutes prior.</li>
                <li><strong>Green Fee:</strong> The green fee is <strong>$52 for walking</strong>, with an additional <strong>$21 per person for a golf cart</strong>.</li>
                <li><strong>Practice Facilities:</strong> Douglaston Golf Course does not have a driving range, but it does feature a **practice putting green**.</li>
                <li><strong>Course Layout:</strong> Douglaston is known for its challenging hilly terrain and scenic views.</li>
                <li><strong>Amenities:</strong> The course has a pro shop and a snack bar/restaurant.</li>
            </ul>
        </section>

        <!-- Footer -->
        <footer>
            <p>&copy; 2025 Parfect Strangers Golf Outings. All rights reserved.</p>
        </footer>

    </div>

    <script>
        const weatherContent = document.getElementById('weather-content');

        // Function to make a fetch call to the Gemini API with exponential backoff
        async function fetchWithExponentialBackoff(payload, retries = 3, delay = 1000) {
            try {
                const apiKey = ""; // API key will be provided by the environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    let text = result.candidates[0].content.parts[0].text;
                    // Attempt to remove markdown code block wrapper if present
                    if (text.startsWith('```json') && text.endsWith('```')) {
                        text = text.substring(7, text.length - 3).trim();
                    } else if (text.startsWith('```') && text.endsWith('```')) {
                        // General markdown block, might not be explicitly 'json'
                        text = text.substring(3, text.length - 3).trim();
                    }
                    return JSON.parse(text);
                } else {
                    throw new Error("Invalid response structure from the API or missing content.");
                }

            } catch (error) {
                console.error("API call error:", error);
                if (retries > 0) {
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchWithExponentialBackoff(payload, retries - 1, delay * 2);
                } else {
                    throw error;
                }
            }
        }

        async function fetchWeather() {
            weatherContent.innerHTML = '<p class="loading-message">Loading weather data...</p>';

            const date = "August 15, 2025";
            const time = "1:42 PM";
            const location = "Douglaston, Queens, NY";

            const prompt = `Provide a detailed weather forecast for ${location} on ${date} at approximately ${time}. Include the high temperature for the day, the condition around the tee time (e.g., sunny, cloudy, partly cloudy, chance of rain), the "feels like" temperature, percentage chance of precipitation, wind speed and direction, and UV index. Present this information as a JSON object with the following structure:
            {
                "high_temp_day": "VALUE",
                "conditions_tee_time": "VALUE",
                "feels_like_temp": "VALUE",
                "precipitation_chance": "VALUE",
                "wind_speed_direction": "VALUE",
                "uv_index": "VALUE",
                "forecast_updated": "VALUE (e.g., August 14, 2025)"
            }`;

            const chatHistory = [{
                role: "user",
                parts: [{ text: prompt }]
            }];

            const payload = {
                contents: chatHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "high_temp_day": { "type": "STRING" },
                            "conditions_tee_time": { "type": "STRING" },
                            "feels_like_temp": { "type": "STRING" },
                            "precipitation_chance": { "type": "STRING" },
                            "wind_speed_direction": { "type": "STRING" },
                            "uv_index": { "type": "STRING" },
                            "forecast_updated": { "type": "STRING" }
                        }
                    }
                }
            };

            try {
                const weatherData = await fetchWithExponentialBackoff(payload);
                renderWeather(weatherData, time);
            } catch (error) {
                weatherContent.innerHTML = '<p class="error-message">Failed to load weather data. Please try again later.</p>';
                console.error("Error fetching weather:", error);
            }
        }

        function renderWeather(data, teeTime) {
            weatherContent.innerHTML = `
                <div class="weather-summary-block">
                    <h3>${data.high_temp_day}</h3>
                    <p>High (for the day)</p>
                </div>
                <div class="weather-summary-block">
                    <h3>${data.conditions_tee_time}</h3>
                    <p>Conditions (around ${teeTime})</p>
                    <p>Feels like ${data.feels_like_temp}</p>
                </div>
                <div class="weather-details">
                    <p class="details-heading">Expected Conditions During Play:</p>
                    <ul>
                        <li>Temperature: The daily high is expected to be <strong>${data.high_temp_day}</strong>, with a "feels like" temperature of <strong>${data.feels_like_temp}</strong>.</li>
                        <li>Precipitation: <strong>${data.precipitation_chance}</strong> chance of rain.</li>
                        <li>Wind: <strong>${data.wind_speed_direction}</strong>.</li>
                        <li>UV Index: <strong>${data.uv_index}</strong>. Sunscreen recommended.</li>
                    </ul>
                    <p class="forecast-update-info">Forecast last updated: ${data.forecast_updated}. Conditions are subject to change. Please check closer to the date.</p>
                    <a href="https://www.google.com/search?q=hourly+weather+Douglaston+NY+August+15+2025" target="_blank" class="forecast-link">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                        Get the Latest Hourly Forecast
                    </a>
                </div>
            `;
        }

        // Fetch weather on page load
        window.onload = fetchWeather;
    </script>
</body>
</html>
